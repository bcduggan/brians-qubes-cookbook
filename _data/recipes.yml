create-admin-global-qube:
  template:
    packages:
      fedora:
        # qvm-* tools
        - qubes-core-admin-client
        # qubesctl
        - qubes-mgmt-salt-admin-tools
  policy:
    - name: "30-{{ page.qube }}"
      content: |
        admin.vm.Create.TemplateVM    *  {{ page.qube }}  @adminvm                         allow  target=dom0
        admin.vm.Create.AppVM         *  {{ page.qube }}  @adminvm                         allow  target=dom0
        admin.vm.Create.StandaloneVM  *  {{ page.qube }}  @adminvm                         allow  target=dom0
        admin.vm.Remove               *  {{ page.qube }}  @tag:created-by-{{ page.qube }}  allow  target=dom0
        qubes.Filecopy                *  {{ page.qube }}  @tag:created-by-{{ page.qube }}  allow
        qubes.WaitForSession          *  {{ page.qube }}  @tag:created-by-{{ page.qube }}  allow
        qubes.VMShell                 *  {{ page.qube }}  @tag:created-by-{{ page.qube }}  allow
    - name: "include/admin-global-rwx"
      content: |
        {{ page.qube }}  @adminvm                         allow  target=dom0
        {{ page.qube }}  @tag:created-by-{{ page.qube }}  allow  target=dom0
        {{ page.qube }}  {{ page.qube }}                  allow  target=dom0

create-admin-policy-qube:
  template:
    packages:
      fedora:
        # qubes-policy* tools
        - qubes-core-qrexec
  policy:
    - name: "include/admin-policy-rwx"
      content: |
        {{ page.qube }}  @adminvm  allow  target=dom0
